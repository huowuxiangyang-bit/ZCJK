name: 政策监控推送

on:
  workflow_dispatch:
    inputs:
      policy_days:
        description: '抓取近N天的政策'
        required: false
        default: '5'
        type: string
  schedule:
    - cron: '50 14 * * *'
    
jobs:
  run:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
      
      - name: Create .env file
        run: |
          mkdir -p config
          echo "DEEPSEEK_API_KEY=${{ secrets.DEEPSEEK_API_KEY }}" > config/.env
          echo "WECHAT_WEBHOOK_URL=${{ secrets.WECHAT_WEBHOOK_URL }}" >> config/.env
          echo "POLICY_DAYS=${{ github.event.inputs.policy_days || '5' }}" >> config/.env
          echo "MONITOR_SITES=https://gss.mof.gov.cn/gzdt/zhengcefabu/" >> config/.env
          echo "MONITOR_SITES=https://www.miit.gov.cn/zwgk/zcwj/index.html" >> config/.env
          echo "MONITOR_SITES=https://www.pbc.gov.cn/goutongjiaoliu/113456/113469/index.html" >> config/.env
          echo "MONITOR_SITES=https://www.ndrc.gov.cn/xxgk/" >> config/.env
          echo "MONITOR_SITES=https://www.mofcom.gov.cn/zcfb/index.html" >> config/.env
          echo "MONITOR_SITES=https://www.gov.cn/zhengce/zuixin/" >> config/.env
      
      - name: Run policy monitor
        run: python main.py
